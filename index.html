<!DOCTYPE html>
<html>
<head>
  <title>firep</title>
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css" crossorigin="anonymous">
  <style type="text/css">
    pre, .pure-g pre, .pure-g [class*=pure-u] pre {font-family: monospace;}
  </style>
</head>
<body class='pure-g'>
  <div class='pure-u-5-6 pure-u-md-1-3' style="margin: 1em auto;">
    <form class='pure-form' id='firep'>
      <input class='pure-u-1' autofocus value="lol from:me date>21-07-2017" />
    </form>

    <pre class='pure-u-1' id='debug'>
      
    </pre>
  </div>
  <script type="text/javascript">
    const opSymbols = {
      ':': 'equal',
      '=': 'equal',
      '>': 'gt',
      '<': 'lt',
      '>=': 'gte',
      '<=': 'lte',
    }

    const parseQuery = function (query) {
      const parts = query.replace(/\s+/, ' ').split(' ').filter(Boolean)

      return {
        filters: [
          parts.map(p => {
            const parsed = p.match(/^([a-z]+)(:|=|<|>|<=|>=)(.+)$/)

            if (!parsed) {
              return {
                key: 'query',
                op: 'equal',
                value: p,
              }
            }

            const [_, key, opSymbol, value] = parsed

            return {
              key,
              op: opSymbols[opSymbol],
              value
            }
          })
        ],
      }
    }

    function updateDebug(input) {
      document.getElementById('debug').innerText = JSON.stringify(
        parseQuery(input.value), null, "  "
      )
    }

    document.getElementById('firep').addEventListener('input', event => {
      updateDebug(event.target)
    })

    updateDebug(document.getElementById('firep').querySelector('input'))
  </script>
</body>
</html>
